
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Status - Pernambuco III</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <!-- ... conteúdo anterior mantido ... -->

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbx9FJ28tJf_h5C4owFjNthBYgNMbkgvzTokk4vL9Asee_1E08pExsSwyYR67Txv9Y476w/exec";
    let equipamentosData = [];
    let equipamentosFiltrados = [];

    document.addEventListener("DOMContentLoaded", function() {
      carregarEquipamentos();
      atualizarRelogio();
      setInterval(atualizarRelogio, 1000);
      setInterval(carregarEquipamentos, 30000);
      document.getElementById("filtro-busca").addEventListener("input", aplicarFiltros);
      document.getElementById("filtro-status").addEventListener("change", aplicarFiltros);
    });

    function carregarEquipamentos() {
      const refreshText = document.getElementById("refresh-text");
      const refreshLoader = document.getElementById("refresh-loader");
      const refreshButton = document.querySelector("button[onclick=\"carregarEquipamentos()\"]");

      if (refreshText && refreshLoader) {
        refreshText.style.display = "none";
        refreshLoader.style.display = "inline-block";
        refreshButton.disabled = true;
      }

      fetch(endpoint)
        .then(response => response.json())
        .then(responseJson => {
          if (!Array.isArray(responseJson.data)) throw new Error("Resposta inesperada da API.");
          const data = responseJson.data;
          if (Array.isArray(data)) {
            equipamentosData = data;
            aplicarFiltros();
            atualizarEstatisticas();
            atualizarUltimaAtualizacao();

            document.getElementById("loading-container").style.display = "none";
            document.getElementById("equipamentos-container").style.display = "grid";
          } else {
            throw new Error("Formato inválido retornado pela API.");
          }
        })
        .catch(error => {
          console.error("Erro ao carregar equipamentos:", error);
          document.getElementById("loading-container").innerHTML = `
            <div style="color: var(--error-color);">Erro ao carregar dados. Tente novamente.</div>
            <button onclick="carregarEquipamentos()" class="form-button" style="margin-top: var(--spacing-4);">Tentar Novamente</button>
          `;
        })
        .finally(() => {
          if (refreshText && refreshLoader) {
            refreshText.style.display = "inline";
            refreshLoader.style.display = "none";
            refreshButton.disabled = false;
          }
        });
    }

    function aplicarFiltros() {
      const busca = document.getElementById("filtro-busca").value.toLowerCase();
      const statusFiltro = document.getElementById("filtro-status").value;

      equipamentosFiltrados = equipamentosData.filter(equip => {
        const matchBusca = !busca || 
          (equip.TAG && equip.TAG.toLowerCase().includes(busca)) ||
          (equip.NOME && equip.NOME.toLowerCase().includes(busca));
        const matchStatus = !statusFiltro || equip.STATUS === statusFiltro;
        return matchBusca && matchStatus;
      });

      renderizarEquipamentos();
    }

    function atualizarRelogio() {
      const agora = new Date();
      const relogio = document.getElementById("relogio");
      relogio.textContent = agora.toLocaleString("pt-BR");
    }
  </script>
</body>
</html>
